#!/usr/bin/env php
<?php

use Symfony\Component\Console\Input\ArgvInput;
use WPSP\WPSP;
use WPSP\routes\Actions;
use WPSP\routes\AdminPages;
use WPSP\routes\Ajaxs;
use WPSP\routes\Apis;
use WPSP\routes\Filters;
use WPSP\routes\MetaBoxes;
use WPSP\routes\NavLocations;
use WPSP\routes\PostTypeColumns;
use WPSP\routes\PostTypes;
use WPSP\routes\RewriteFrontPages;
use WPSP\routes\WPRoles;
use WPSP\routes\Schedules;
use WPSP\routes\Shortcodes;
use WPSP\routes\Taxonomies;
use WPSP\routes\TaxonomyColumns;
use WPSP\routes\Templates;
use WPSP\routes\UserMetaBoxes;

//define('WPSP_START', microtime(true));

require_once __DIR__ . '/../../../wp-load.php';

/**
 * Kiểm tra plugin đã được kích hoạt hay chưa để sử dụng artisan.
 */
$pluginDir      = plugin_dir_path(__FILE__);
$pluginDirName  = plugin_basename($pluginDir);

if (!is_plugin_active($pluginDirName . '/main.php')) {
    echo "\033[31m[X] Vui lòng kích hoạt plugin để sử dụng artisan!\033[0m\n";
    exit(1);
}

/**
 * Load composer autoload.
 */
require __DIR__ . '/vendor/autoload.php';

/**
 * ---
 * Start application.
 */
$wpsp = WPSP::startConsole();

/**
 * ---
 * Đăng ký routes.
 */
foreach ([
    WPRoles::class,
    Apis::class,
    Ajaxs::class,
    Schedules::class,
    PostTypes::class,
    PostTypeColumns::class,
    MetaBoxes::class,
    Templates::class,
    Taxonomies::class,
    TaxonomyColumns::class,
    Shortcodes::class,
    AdminPages::class,
    NavLocations::class,
    UserMetaBoxes::class,
    RewriteFrontPages::class,
    Actions::class,
    Filters::class,
] as $route) {
    (new $route())->register();
}

/**
 * ---
 * Xử lý command line.
 */
$app    = $wpsp->getApplication();
$status = $app->handleCommand(new ArgvInput);
exit($status);