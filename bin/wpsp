#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

use Symfony\Component\Console\Application;
use WPSP\app\Extras\Instances\Database\Eloquent;
use WPSP\app\Extras\Instances\Environment\Environment;
use WPSP\app\Extras\Instances\Routes\MapRoutes;
use WPSP\Funcs;
use WPSPCORE\Console\Kernel as ConsoleKernel;

try {
    /**
     * Environment.
     */
    Environment::init(__DIR__ . '/../');

    /**
     * Define variables.
     */
    $application   = new Application();
    $mainPath      = Funcs::instance()->_getMainPath();
    $rootNamespace = Funcs::instance()->_getRootNamespace();
    $prefixEnv     = Funcs::instance()->_getPrefixEnv();

    /**
     * Init vendor commands.
     */
    ConsoleKernel::initCommands(
        $mainPath,
        $rootNamespace,
        $prefixEnv,
        [
            'funcs'       => Funcs::instance(),
            'eloquent'    => class_exists('WPSPCORE\Database\Eloquent') ? Eloquent::instance() : null,
            'mapRoutes'   => MapRoutes::instance(),
            'environment' => Environment::instance(),
            'application' => $application,
        ]
    );

    /**
     * Your custom commands define below here.
     */
    $customCommands = Funcs::config('commands');

    /**
     * Add custom commands to application.
     */
    foreach ($customCommands as $customCommand) {
        if ($customCommand) $application->add(new $customCommand($mainPath, $rootNamespace, $prefixEnv, [
                'funcs'       => Funcs::instance(),
                'eloquent'    => class_exists('WPSPCORE\Database\Eloquent') ? Eloquent::instance() : null,
                'mapRoutes'   => MapRoutes::instance(),
                'environment' => Environment::instance(),
                'application' => $application,
        ]));
    }

    /**
     * Run application.
     */
    $application->run();
}
catch (Exception $e) {
    Funcs::debug($e, true);
    die($e->getMessage());
}