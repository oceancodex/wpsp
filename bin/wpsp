#!/usr/bin/env php
<?php
define('WPSP_CONSOLE_IGNORE_QUEUE', true);
require __DIR__ . '/../vendor/autoload.php';

use Symfony\Component\Console\Application;
use WPSP\app\Workers\Container\Container;
use WPSP\app\Workers\Database\Eloquent;
use WPSP\app\Workers\Database\Migration;
use WPSP\app\Workers\Environment\Environment;
use WPSP\app\Workers\Queue\Queue;
use WPSP\Funcs;
use WPSPCORE\Console\Kernel as ConsoleKernel;

try {
    /**
     * Environment.
     */
    Environment::init(__DIR__ . '/../');

    /**
     * Define variables.
     */
    $application   = new Application();
    $funcs         = Funcs::instance();
    $mainPath      = $funcs->_getMainPath();
    $rootNamespace = $funcs->_getRootNamespace();
    $prefixEnv     = $funcs->_getPrefixEnv();

    /**
     * Init vendor commands.
     */
    ConsoleKernel::initCommands(
        $mainPath,
        $rootNamespace,
        $prefixEnv,
        [
            'funcs'       => $funcs,
            'application' => $application,
        ]
    );

    /**
     * Your custom commands define below here.
     */
    $customCommands = Funcs::config('commands');

    /**
     * Add custom commands to application.
     */
    foreach ($customCommands as $customCommand) {
        if ($customCommand) $application->add(new $customCommand($mainPath, $rootNamespace, $prefixEnv, [
                'funcs'       => $funcs,
                'application' => $application,
        ]));
    }

    /**
     * Run application.
     */
    $application->run();
}
catch (Exception $e) {
    Funcs::debug($e, true);
    die($e->getMessage());
}